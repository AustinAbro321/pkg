name: install-tools
description: "Install pipeline tools"
inputs:
  module-name:
    description: "The package to be released"
    required: true

runs:
  using: composite
  steps:
    - name: bump module version
      id: module-tag
      run: |
        echo "new-version=$(go run internal/release/main.go ${{ inputs.module-name }})" >> $GITHUB_OUTPUT
      shell: bash
      #${{ steps.module-tag.outputs.new-version }}


    - name: install git cliffs
      env:
        # renovate: datasource=github-tags depName=orhun/git-cliff versioning=semver
        VERSION: 2.1.1
      run: |
        curl --location --output /tmp/git-cliffs.tar.gz https://github.com/orhun/git-cliff/releases/download/v${VERSION}/git-cliff-${VERSION}-x86_64-unknown-linux-gnu.tar.gz
        tar -xvzf /tmp/git-cliffs.tar.gz -C /tmp
        mv /tmp/git-cliff-${VERSION}/git-cliff /usr/local/bin/
      shell: bash

    - name: generate release notes
      run: |
        git cliff --tag ${{ steps.module-tag.outputs.new-version }} --include-path "${{ github.event.inputs.packageName }}/*" > notes.txt
      shell: bash

    - name: Release
      env:
        GH_TOKEN: ${{ github.token }}
      run: |
        gh release create ${{ steps.module-tag.outputs.new-version }} --notes-file notes.txt
      shell: bash
